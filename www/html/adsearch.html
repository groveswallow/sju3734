<!--
 * @Author: Tang
 * @Date: 2019-11-22 22:30:55
 * @LastEditors: Tang
 * @LastEditTime: 2020-04-06 21:21:51
 * @Description: 待解决：搜索框上方的描述套话。
 * autocom函数虽然已经完成，但是ＴＦ的ｅｎｓｅｍｂｌｅ数据未拿到，所以要注意修改ＴＦ的后端。2020.1.2
 * Postdetail函数为跳转detail页面的函数，具体的还未编写。2020.1.13
 -->
<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="icon" href="./icon.ico">
    <link href="./bs/css/bootstrap.min.css" rel="stylesheet">
    <link href="./bs/css/bootstrap-select.min.css" rel="stylesheet">
    <link href="./bs/css/bootstrap-table.min.css" rel="stylesheet">
    <script src="./bs/js/jquery.min.js"></script>
    <script src="./bs/js/bootstrap.min.js"></script>
    <script src="./bs/js/bootstrap-select.min.js"></script>
    <script src="./bs/js/bootstrap-table.min.js"></script>
    <script src="./bs/js/bootstrap3-typeahead.min.js"></script>
    <!-- <script src="./bs/js/bootstrap-table-zh-CN.min.js"></script> -->
    <script src="./bs/js/tableExport.min.js"></script>
    <script src="./bs/js/bootstrap-table-export.min.js"></script>
    <title>TFcancer</title>
</head>

<body background="" class="float center-block">
    <script>
        function autoselect() {
            $.ajax({
                url: './autoselect.php',
                cache: false,
                type: 'get',
                dataType: 'json',
                async: true,
                success: function (res) {
                    var data = res[0];
                    var data1 = res[1];
                    var options = [], _options;
                    var options1 = [], _options1;
                    var d0 = 0;
                    var d1 = 0;
                    for (var i = 0; i < data.length; i++) {
                        if (data[i] == 'regulate' && d0 == 0) {
                            var option = '<option selected="selected" value="' + data[i] + '">' + data[i] + '</option>';
                            options.push(option);
                            d0 = 1;
                        }
                        else {
                            var option = '<option value="' + data[i] + '">' + data[i] + '</option>';
                            options.push(option);
                        }
                    }
                    for (var i = 0; i < data1.length; i++) {
                        if (data1[i] == 'negative' && d1 == 0) {
                            var option = '<option selected="selected" value="' + data1[i] + '">' + data1[i] + '</option>';
                            options1.push(option);
                            d1 = 1;
                        }
                        else {
                            var option = '<option value="' + data1[i] + '">' + data1[i] + '</option>';
                            options1.push(option);
                        }
                    }
                    _options1 = options1.join('');
                    _options = options.join('');
                    // console.log(_options);
                    // console.log(_options1);
                    $('#regulation_type')[0].innerHTML = _options1;
                    $('#characteristics')[0].innerHTML = _options;
                    $('#characteristics').selectpicker('refresh');
                    $('#characteristics').selectpicker('render');
                    $('#regulation_type').selectpicker('refresh');
                    $('#regulation_type').selectpicker('render');
                }
            })
        }
        function autocom(flag) {
            $('#' + flag).typeahead({
                minLength: 1,
                items: 10,
                hint: true,
                cache: false,
                highlight: true,
                source: function (query, process) {
                    let pl ={}
                    pl[flag] = query;
                    console.log(pl);
                    $.ajax({
                        url: "./autocom.php",
                        cache: false,
                        type: 'post',
                        dataType: 'json',
                        async: true,
                        data: pl,
                        success: function (data) {
                            return process(data);
                        }
                    })
                }
            })
        }
        function Postdetail(tf, cancer, gene) {
            $.ajax({
                url: "./detail.php",
                cache: false,
                async: true,
                type: 'get',
                data: {
                    'cancer': cancer,
                    'tf': tf,
                    'gene': gene,
                },
                success: function () {
                    location.href = './detail.php?' + 'tf=' + tf + '&cancer=' + cancer + '&gene=' + gene + '';
                }
            })
        }
        function autovalue(flag) {
            var vdefault = $('#' + flag).val();

            $('#' + flag).focus(function () {
                //获得焦点时，如果值为默认值，则设置为空  
                if ($(this).val() == vdefault) {
                    $(this).val("");
                }
            });
            $('#' + flag).blur(function () {
                //失去焦点时，如果值为空，则设置为默认值  
                if ($(this).val() == "") {
                    $(this).val(vdefault);;
                }
            });
        }
        function Post() {
            var query = {
                tf: $('#tf').val(),
                cancer_type: $('#cancer_type').val(),
                gene: $('#gene').val(),
                hallmark: $('#hallmark').val(),
                regulation_type: $('#regulation_type').val(),
                characteristics: $('#characteristics').val(),
            };
            $.ajax({
                url: './adtable.php',
                cache: false,
                method: 'post',
                dataType: 'json',
                async: true,
                data: query,
                success: function (result) {
                    $(function () {
                        $('#serv').remove();
                    })
                    $('#table').bootstrapTable({
                        searchAlign: 'left',
                        theadClasses: 'thead-dark',
                        showButtonIcons: true,
                        showSearchButton: true,
                        showLoading: true,
                        striped: true,
                        clickToSelect: true,
                        showFullscreen: true,
                        showToggle: false,
                        search: true,
                        showColumns: true,                  //是否显示所有的列
                        showRefresh: true,
                        cache: false,
                        sidePagination: "client",           //分页方式：client客户端分页，server服务端分页（*）
                        pagination: true,                   //是否显示分页（*）
                        showExtendedPagination: true,
                        showExport: true,
                        pageNumber: 1,                       //初始化加载第一页，默认第一页
                        pageSize: 5,                       //每页的记录行数（*）
                        pageList: [10, 25, 50, 100],        //可供选择的每页的行数（*）
                        columns: [{
                            checkbox: true,
                        },
                        {
                            field: 'pmid',
                            title: 'Pmid',
                            align: 'center',
                        }
                            ,
                        {
                            field: 'cancer',
                            title: 'Cancer Category',
                            align: 'center',
                        }, {
                            field: 'tf',
                            title: 'TF',
                            align: 'center',
                        }, {
                            field: 'characteristics',
                            title: 'Characteristics',
                            align: 'center',
                        }, {
                            field: 'gene',
                            title: 'Gene',
                            align: 'center',
                        },
                        {
                            field: 'regulation_type',
                            title: 'Regulation type',
                            align: 'center',
                        },
                        {
                            field: 'hallmark',
                            title: 'Processes & Pathways',
                            align: 'center',
                        },
                        {
                            field: 'title',
                            title: 'Title',
                            align: 'center'
                        },
                        {
                            field: 'tf',
                            title: 'details',
                            align: 'center',
                            formatter: function (value, row, index) {
                                return '<a href="#" onclick = "Postdetail(\'' + row.tf + '\',\'' + row.cancer + '\',\'' + row.gene + '\')">details....</a>'
                            }
                        }
                        ],
                        data: result,        // 表格数据来源
                        formatNoMatches: function () {
                            return "We did not find the result."
                        },
                        formatLoadingMessage: function () {
                            return "Loading.........";
                        }
                    });
                },
                error: function () {
                    alert('We did not find the results!');
                }
            });
            return false;
        }
    </script>
    <header style="background-color:whitesmoke;" id='header'>
        <script>
            $.ajaxSetup({
                cache: false //close AJAX cache
            });
            $(function () {
                $('#header').load('./header.html');
            })
        </script>
    </header>
    <div class="center-block" style="width: 60%;">
        <table id='table' class='center-block' style="table-layout: fixed;"></table>
    </div>
    <div id="serv" style="width: 100%;height: 70%;">
        <div style="width: 45%; height:180px; margin-top: 2%; text-align: center" class='center-block'>
            <h1 style="font-size: 30px;"><span class="glyphicon glyphicon-search" aria-hidden="true"
                    style="font-size: 30px;"></span><b>The
                    Interface of Advanced Search</b></h1>
            <hr class="simple" color="black" style="height: 2px;">
            <p style="font-size: 20px;">In advanced search,TFcancer provides more complex functions compared witg
                general
                search.</p>
            <p style="font-size: 20px;">Here, users can select <b>mode of regulation type</b>,<b>tf
                    characteristics</b>,<b>Gene name</b> and <b>cancer hallmark</b> as the need arises.</p>
            <p style="font-size: 20px;">
                All above support fuzzy search.
            </p>
            <hr>
            <div class="center-block" style="width: 80%;">
                <form class='form-horizontal' action="" method="post" onsubmit="return Post();">
                    <div style="width: 100%;height: 55%;">
                        <div class="input-group"> <span class="input-group-addon" id="basic-addon1">TF</span>
                            <input type="text" class="form-control" placeholder="Search for TF" id="tf" value="BRCA1" autocomplete="off">
                        </div>
                        <div class="col-lg-5" style="margin-left: 8%;margin-top: 2%;">
                            <label>Select TF Characteristics</label>
                            <select multiple class="selectpicker form-control" id="characteristics"
                                title="Select Characteristics" ddata-container="body" data-live-search="true"
                                data-hide-disabled="true" data-actions-box="true" data-virtual-scroll="false"
                                >
                            </select>
                        </div>
                        <div class="col-lg-5" style="margin-left: 5%;margin-top: 2%;">
                            <label>Select Regulation Mode</label>
                            <select multiple class="selectpicker form-control" id="regulation_type"
                                title="Select Regulation Type" data-container="body" data-live-search="true"
                                data-hide-disabled="true" data-actions-box="true" data-virtual-scroll="false"
                                >
                            </select>
                        </div>
                        <script>
                            autoselect();
                        </script>
                    </div>
                    <br>
                    <br>
                    <br>
                    <br>
                    <hr>
                    <div class="input-group"> <span class="input-group-addon" id="basic-addon1">Cancer</span>
                        <input type="text" class="form-control" placeholder="Search for Cancer" id="cancer_type"
                            value='Breast invasive carcinoma' autocomplete="off">
                    </div>
                    <hr>
                    <div class="input-group"> <span class="input-group-addon" id="basic-addon1">Gene</span>
                        <input type="text" class="form-control" placeholder="Search for Gene" id="gene" value="GADD45A" autocomplete="off">
                    </div>
                    <hr>
                    <div class="input-group"> <span class="input-group-addon" id="basic-addon1">Hallmark</span>
                        <input type="text" class="form-control" placeholder="Search for Hallmark of Cancer"
                            id="hallmark" value="tumorigenesis" autocomplete="off"></div>
                    <!-- //未解决页面缩小后按钮被页脚遮挡的BUG -->
                    <button class="btn btn-default" type="reset" id="reset"
                        style="margin-top: 3%;"><b>Reset</b></button>
                    <script>
                        $(function () {
                            $('#reset').click(function () {
                                $('#gene').val('');
                                $('#cancer_type').val('');
                                $('#tf').val('');
                                $('#hallmark').val('');
                            })
                        })
                    </script>
                    <button class="btn btn-default" type="submit" id="sub"
                        style="margin-top: 3%;"><b>Search</b></button>
                    <script>
                        $(function () {
                            $.ajaxSetup({
                                cache: false //close AJAX cache
                            });
                            autocom("tf");
                            autocom('cancer_type');
                            autocom('gene');
                            autocom('hallmark');
                            autovalue("tf");
                            autovalue('cancer_type');
                            autovalue('gene');
                            autovalue('hallmark');
                        })
                    </script>
                </form>
            </div>
        </div>
    </div>
</body>

</html>
<!--
 * @Author: Tang
 * @Date: 2019-11-22 22:30:55
 * @LastEditors: Tang
 * @LastEditTime: 2020-03-22 10:31:21
 * @Description: 待解决：搜索框上方的描述套话。
 * autocom函数虽然已经完成，但是ＴＦ的ｅｎｓｅｍｂｌｅ数据未拿到，所以要注意修改ＴＦ的后端。2020.1.2
 * Postdetail函数为跳转detail页面的函数，具体的还未编写。2020.1.13
 -->
<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="./bs/css/bootstrap.min.css" rel="stylesheet">
    <link href="./bs/css/bootstrap-select.css" rel="stylesheet">
    <link href="./bs/css/bootstrap-table.min.css" rel="stylesheet">
    <script src="./bs/js/jquery.min.js"></script>
    <script src="./bs/js/bootstrap.min.js"></script>
    <script src="./bs/js/bootstrap-select.js"></script>
    <script src="./bs/js/bootstrap-table.min.js"></script>
    <script src="./bs/js/bootstrap3-typeahead.min.js"></script>
    <script src="./bs/js/bootstrap-table-zh-CN.min.js"></script>
    <script src="./bs/js/tableExport.min.js"></script>
    <script src="./bs/js/bootstrap-table-export.min.js"></script>
    <title>XXXdatabase</title>
</head>

<body background="" class="float">
    <script>
        $('＃serv').hide();
        function autocom(flag) {
            $('#' + flag).typeahead({
                minLength: 1,
                items: 10,
                hint: true,
                highlight: true,
                source: function (query, process) {
                    $.ajax({
                        url: "./autocom.php",
                        cache: false,
                        type: 'post',
                        dataType: 'json',
                        async: true,
                        data: {
                            flag: query,
                        },
                        success: function (data) {
                            return process(data);
                        }
                    })
                }
            })
        }
        function Postdetail(tf, cancer, gene) {
            $.ajax({
                url: "./detail.php",
                cache: false,
                async: true,
                type: 'get',
                data: {
                    'cancer': cancer,
                    'tf': tf,
                    'gene': gene,
                },
                success: function () {
                    location.href = './detail.php?' + 'tf=' + tf + '&cancer=' + cancer + '&gene=' + gene + '';
                }
            })
        }
        function autovalue(flag) {
            var vdefault = $('#' + flag).val();

            $('#' + flag).focus(function () {
                //获得焦点时，如果值为默认值，则设置为空  
                if ($(this).val() == vdefault) {
                    $(this).val("");
                }
            });
            $('#' + flag).blur(function () {
                //失去焦点时，如果值为空，则设置为默认值  
                if ($(this).val() == "") {
                    $(this).val(vdefault);;
                }
            });
        }
        function Post() {
            var query = {
                tf: $('#tf').val(),
                cancer_type: $('#cancer_type').val(),
            };
            // var tf = $('#tf').val();
            // var regulation_type = $('#regulation_type').val(); 
            // var characteristics = $('#characteristics').val();
            // var cancer_type = $('#cancer_type').val();
            // var gene = $('#gene').val();
            // var hallmark = $('#hallmark').val();
            // var flag = 0;
            // var va = [$('#tf').val(), $('#cancer_type').val(), $('#gene').val(), $('#hallmark').val()]
            // var patt = /[^0-9A-Za-z]/;
            $.ajax({
                url: './getable.php',
                cache: false,
                method: 'post',
                dataType: 'json',
                async: true,
                data: query,
                success: function (result) {
                    $(function () {
                        $('#serv').remove();
                    })
                    $('#table').bootstrapTable({
                        showLoading: true,
                        striped: true,
                        clickToSelect: true,
                        showFullscreen: true,
                        showToggle: false,
                        search: true,
                        showColumns: true,                  //是否显示所有的列
                        showRefresh: true,
                        cache: false,
                        sidePagination: "client",           //分页方式：client客户端分页，server服务端分页（*）
                        pagination: true,                   //是否显示分页（*）
                        showExport: true,
                        pageNumber: 1,                       //初始化加载第一页，默认第一页
                        pageSize: 10,                       //每页的记录行数（*）
                        pageList: [10, 25, 50, 100],        //可供选择的每页的行数（*）
                        columns: [{
                            checkbox: true
                        },
                        {
                            field: 'pmid',
                            title: 'Pmid'
                        }
                            ,
                        {
                            field: 'cancer',
                            title: 'Cancer Category'
                        }, {
                            field: 'tf',
                            title: 'TF'
                        }, {
                            field: 'gene',
                            title: 'Gene'
                        }, {
                            field: 'characteristics',
                            title: 'Characteristics'
                        },
                        {
                            field: 'regulation_type',
                            title: 'Regulation_type'
                        },
                        {
                            field: 'hallmark',
                            title: 'Cancer_hallmark'
                        },
                        {
                            field: 'title',
                            title: 'Title'
                        },
                        {
                            field: 'tf',
                            title: 'details',
                            align: 'center',
                            formatter: function (value, row, index) {
                                return '<a href="#" onclick = "Postdetail(\'' + row.tf + '\',\'' + row.cancer + '\',\'' + row.gene + '\')">details....</a>'
                            }
                        }
                        ],
                        data: result,        // 表格数据来源
                        formatNoMatches: function () {
                            return "We did not find the result."
                        },
                        formatLoadingMessage: function () {
                            return "Loading.........";
                        }
                    });
                },
                error: function () {
                    alert('We did not find the results!');
                }
            });
            return false;
        }
    </script>
    <header style="background-color:whitesmoke;" id='header'>
        <script>
            $.ajaxSetup({
                cache: false //close AJAX cache
            });
            $(function () {
                $('#header').load('./header.html');
            })
        </script>
    </header>
    <table id='table'></table>
    <div id='serv' style="width: 50%; height:200px; margin-top: 2%; text-align: center" class='center-block'>
        <h1 style="font-size: 30px;"><span class="glyphicon glyphicon-search" aria-hidden="true"
                style="font-size: 30px;"></span> <b>The
            Interface of General Search</b></h1>
        <hr class="simple" color="black" style="height: 2px;" />
        <p style="font-size: 20px;">TFcancer provides users with a simple and fast way to search and explore all data in
            several ways, namely searching by cancer name or transcription factors. </p>
        <p style="font-size: 20px;">
            Fuzzy keyword searching is also available. The closest matching records will be returned. Advanced search
            provides more detailed and systemic search results. 
        </p>
        <div style="width: 75%; height:200px; margin-left:10%; padding-top: 3%; text-align: center">
            <label style="font-size: 15px;font-family: monospace;">For 'transcription factors', you can use simple TF name (e.g. 'p53').
            </label>
            <div id="sertf">
                <form action="" method="post" onsubmit="return Post();">
                    <input type="text" class="form-control" placeholder="Search for TF" id="tf" value="p53">
                    <hr>
                    <label style="font-size: 15px;font-family: monospace;">For 'Cancer', you can use Cancer name (e.g. 'breast
                        cancer').</label>
                    <input type="text" class="form-control" placeholder="Search for Cancer" id="cancer_type"
                        value="Breast invasive carcinoma">
                    <script>
                        $(function () {
                            autovalue('tf');
                            autovalue('cancer_type');
                            autocom('tf');
                            autocom('cancer_type');
                        })
                    </script>
                    <button class="btn btn-default" type="reset" id="reset"
                        style="margin-top: 5%;"><b>Reset</b></button>
                    <button class="btn btn-default" type="submit" id="sub"
                        style="margin-top: 5%;"><b>Search</b></button>
                </form>
            </div>
        </div>
    </div>
    <footer class="footer navbar-fixed-bottom" style="background-color:whitesmoke;">
        <p style="height: 10px;margin-left: 48%;">©CopyRight 2020 Guo Laboratory</p>
    </footer>
</body>

</html>
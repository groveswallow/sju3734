<!--
 * @Author: Tang
 * @Date: 2019-11-22 22:30:55
 * @LastEditors: Tang
 * @LastEditTime: 2020-03-30 09:58:09
 * @Description: 待解决：搜索框上方的描述套话。
 * autocom函数虽然已经完成，但是ＴＦ的ｅｎｓｅｍｂｌｅ数据未拿到，所以要注意修改ＴＦ的后端。2020.1.2
 * Postdetail函数为跳转detail页面的函数，具体的还未编写。2020.1.13
 -->
<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="icon" href="./icon.ico">
    <link href="./bs/css/bootstrap.min.css" rel="stylesheet">
    <link href="./bs/css/bootstrap-select.css" rel="stylesheet">
    <link href="./bs/css/bootstrap-table.min.css" rel="stylesheet">
    <script src="./bs/js/jquery.min.js"></script>
    <script src="./bs/js/bootstrap.min.js"></script>
    <script src="./bs/js/bootstrap-select.js"></script>
    <script src="./bs/js/bootstrap-table.min.js"></script>
    <script src="./bs/js/bootstrap3-typeahead.min.js"></script>
    <!-- <script src="./bs/js/bootstrap-table-zh-CN.min.js"></script> -->
    <script src="./bs/js/tableExport.min.js"></script>
    <script src="./bs/js/bootstrap-table-export.min.js"></script>
    <title>TFcancer</title>
</head>

<body background="" class="float">
    <script>
        function autotable() {
            $.ajax({
                url: './downtable.php',
                cache: false,
                type: 'get',
                dataType: 'json',
                async: true,
                success: function (res) {
                    var data = res;
                    var options = [], _options;
                    var flag = 1;
                    var option = '<thead><tr><th class="col-md-2" style="text-align: center;"><h4><b>1</b></h4></th>' +
                        '<th class="col-md-2" style="text-align: center;"><h4><b>2</b></h4></th>' +
                        '<th class="col-md-2" style="text-align: center;"><h4><b>3</b></h4></th>' +
                        '<th class="col-md-2" style="text-align: center;"><h4><b>4</b></h4></th>' +
                        '<th class="col-md-2" style="text-align: center;"><h4><b>5</b></h4></th>' +
                        '<th class="col-md-2" style="text-align: center;"><h4><b>6</b></h4></th>' +
                        '<th class="col-md-2" style="text-align: center;"><h4><b>7</b></h4></th>' +
                        '<th class="col-md-2" style="text-align: center;"><h4><b>8</b></h4></th></tr><tbdoy>';
                    options.push(option);
                    for (var i = 0; i < data.length; i++) {
                        var x = i + 1;
                        if (x % 8 != 0 && flag == 1) {
                            flag = 0;
                            var option = '<tr>';
                            options.push(option);
                        }
                        var option = '<td style="text-align: center;">' + '<a href="#" onclick="Post(\'' + data[i] + '\')" class="btn btn-lg" type="button" style="background-color:whitesmoke;color: black;margin-left: 15px;">' + data[i] + '</a>' + '</td>';
                        options.push(option);
                        if (x % 8 == 0 || i == data.length) {
                            flag = 1;
                            var option = '</tr>';
                            options.push(option);
                        }
                    }
                    option = '</tbody>'
                    options.push(option);
                    _options = options.join('');
                    console.log(_options);
                    $('#tb')[0].innerHTML = _options;
                }
            })
        }
        function Postdetail(tf, cancer, gene) {
            $.ajax({
                url: "./detail.php",
                cache: false,
                async: true,
                type: 'get',
                data: {
                    'cancer': cancer,
                    'tf': tf,
                    'gene': gene,
                },
                success: function () {
                    location.href = './detail.php?' + 'tf=' + tf + '&cancer=' + cancer + '&gene=' + gene + '';
                }
            })
        }
        function Post(cancer_type) {
            var query = {
                'cancer_type': cancer_type,
            };
            $.ajax({
                url: './brotable.php',
                cache: false,
                method: 'post',
                dataType: 'json',
                async: true,
                data: query,
                success: function (result) {
                    $(function () {
                        $('#serv').remove();
                    })
                    $('#table').bootstrapTable({
                        searchAlign: 'left',
                        theadClasses: 'thead-dark',
                        showButtonIcons: true,
                        showSearchButton: true,
                        showLoading: true,
                        striped: true,
                        clickToSelect: true,
                        showFullscreen: true,
                        showToggle: false,
                        search: true,
                        showColumns: true,                  //是否显示所有的列
                        showRefresh: true,
                        cache: false,
                        sidePagination: "client",           //分页方式：client客户端分页，server服务端分页（*）
                        pagination: true,                   //是否显示分页（*）
                        showExtendedPagination: true,
                        showExport: true,
                        pageNumber: 1,                       //初始化加载第一页，默认第一页
                        pageSize: 5,                       //每页的记录行数（*）
                        pageList: [10, 25, 50, 100],        //可供选择的每页的行数（*）
                        columns: [{
                            checkbox: true,
                        },
                        {
                            field: 'pmid',
                            title: 'Pmid',
                            align: 'center',
                        }
                            ,
                        {
                            field: 'cancer',
                            title: 'Cancer Category',
                            align: 'center',
                        }, {
                            field: 'tf',
                            title: 'TF',
                            align: 'center',
                        }, {
                            field: 'gene',
                            title: 'Gene',
                            align: 'center',
                        }, {
                            field: 'characteristics',
                            title: 'Characteristics',
                            align: 'center',
                        },
                        {
                            field: 'regulation_type',
                            title: 'Regulation_type',
                            align: 'center',
                        },
                        {
                            field: 'hallmark',
                            title: 'Cancer_hallmark',
                            align: 'center',
                        },
                        {
                            field: 'title',
                            title: 'Title',
                            align: 'center'
                        },
                        {
                            field: 'tf',
                            title: 'details',
                            align: 'center',
                            formatter: function (value, row, index) {
                                return '<a href="#" onclick = "Postdetail(\'' + row.tf + '\',\'' + row.cancer + '\',\'' + row.gene + '\')">details....</a>'
                            }
                        }
                        ],
                        data: result,        // 表格数据来源
                        formatNoMatches: function () {
                            return "We did not find the result."
                        },
                        formatLoadingMessage: function () {
                            return "Loading.........";
                        }
                    });
                },
                error: function () {
                    alert('We did not find the results!');
                }
            });
            return false;
        }
    </script>
    <header style="background-color:whitesmoke;" id='header'>
        <script>
            $.ajaxSetup({
                cache: false //close AJAX cache
            });
            $(function () {
                $('#header').load('./header.html');
            })
        </script>
    </header>
    <div class="center-block" style="width: 60%;">
        <table id='table' class='center-block'></table>
    </div>
    <div id='serv' style="width: 50%; height:200px; margin-top: 2%; text-align: center" class='center-block'>
        <h1 style="font-size: 30px;"><span class="glyphicon glyphicon-search" aria-hidden="true"
                style="font-size: 30px;"></span> <b>The
                Interface of Browse</b></h1>
        <hr class="simple" color="black" style="height: 2px;" />
        <p style="font-size: 20px;font-family: monospace;margin-bottom: 40px;">Click the symbol to view TF details Page. e.g. location of
            TFBS, TSS and gene expression levels of a TF across the tissues, etc. </p>
        <table class="table table-hover" data-toggle="table" data-height='700' id='tb'>
        </table>
        <script>
            $(function () {
                autotable();
                $('.fixed-table-border').css('height', '0px');
            })
        </script>
    </div>
    <!-- <footer class="footer navbar-fixed-bottom" style="background-color:whitesmoke;">
        <p style="height: 15px;text-align: center;">©CopyRight 2020 Guo Laboratory</p>
    </footer> -->
</body>

</html>